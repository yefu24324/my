---
title: Git提交使用GPG签名
excerpt: GPG（GNU Privacy Guard）是一种开源的加密软件，某天发现Github贡献代码中，项目管理者和我说提交的信息请使用GPG加签后提交。那天我把GPG是什么，怎么使用全都搞清楚了一遍
publishDate: '2025/09/05'
tags:
  - Guide
  - Technology
  - Windows
  - Git
  - Gpg
---
import { Aside, Steps, Tabs, TabItem, Icon } from '@astrojs/starlight/components';
import { Accordions, Accordion } from "../../../components/mdx/accordion";

<Aside>适合Windows系统中想要使用kleopatra工具的用户阅读，非Windows用户需要使用同定位的其他gpg软件来管理密钥。当然你也可以选择跳过安装直接查看使用步骤，不会有太大区别。</Aside>

GPG（GNU Privacy Guard）是一种遵循OpenPGP标准的开源加密软件。我们可以用于加密内容，可以使用到文件、邮件等地方进行加密，加密后的内容，除非拥有私钥不然谁也无法解密得知邮件中的内容。

在使用 `git commit` 时，我们可以使用GPG签名提交，以确保提交的作者身份和提交的内容不会被窜改。

等等...Git提交是如何伪造提交的。其实在使用Git前我们都配置了用户名与邮箱，这个邮箱我们可以选择一位倒霉朋友装成自己。

```sh title="配置Git用户名与邮箱"
git config --global user.name "Your Name"
git config --global user.email "youremail@yourdomain.com"
```

## 安装
可以选择自安装gpg程序，也可以使用Git自带的gpg程序。如何选择就看你是否想要自己管理gpg密钥。

如何选择看：

+ gpg4win：使用gpg4win可以用Gui界面方式操作，但需要自己安装和多一些配置步骤。
+ git：开发者自带且不用多一步配置，缺点是无界面

密钥换电脑时会有需要备份或修改密钥中用户信息，已经gpg密钥支持增加子密钥多台电脑中使用，深入使用带有Gui程序会减少心智负担。不想深入使用什么配置都不配就好。

<Tabs syncKey="opengpg">
    <TabItem label="Kleopatra" icon="seti:windows">
        下载地址: <Icon class="inline" name="cloud-download" label="Gpg4win" /> [Gpg4win - Get Gpg4win <img src="https://www.gpg4win.org/favicon.png" class="size-4 inline"/>](https://www.gpg4win.org/get-gpg4win.html)

        安装时请选择Kleopatra, 我们将用kleopatra工具来管理Gpg密钥. 只安装gpg4win接下来的操作要用命令行了.
        ![](/blogs/git-commit-gpg/install-gpg4win.png)
    </TabItem>
    <TabItem label="Git Bash 🚧" icon="seti:git">
        直接安装Git, 但使用时需要使用Git Bash。
        <Aside type="caution">🚧施工中。。。</Aside>
    </TabItem>
</Tabs>

## 使用

### 1. 创建GPG密钥

<Tabs syncKey="opengpg">
    <TabItem label="Kleopatra" icon="seti:windows">

        <Steps>

        1. 新建 OpenGPG 密钥对

            ![](/blogs/git-commit-gpg/create-openpgp-01.png)

        2. 填写内容

            - ①：输入名字与邮件地址
            - ②：使用密码句保护生成的密钥（每次使用密钥时需要输入密码，即使别人获取到密钥也得输入正确密码才能使用）
            - ③：Key Material 选择加密算法，（可选可不选，我使用rsa4096的算法）
            - ④：valid until取消勾选（因为自用为了方便我选择不加有效期）

             ![](/blogs/git-commit-gpg/create-openpgp-02.png)

        3. 输入保护密码（两次）

             ![](/blogs/git-commit-gpg/create-openpgp-03.png)

        4. 如密钥太过简单时会出现提示

            可直接选择take this one anyway跳过（不要使用123456这样简单的密码）
            ![](/blogs/git-commit-gpg/create-openpgp-04.png)

        5. 创建成功

            ![](/blogs/git-commit-gpg/create-openpgp-05.png)

        </Steps>
    </TabItem>
    <TabItem label="Git Bash 🚧" icon="seti:git">
        打开Git Bash终端输入:

        ```bash
        gpg --full-generate-key
        ```

        按提示步骤，选择用rsa加密算法长度4096位的密钥对（密钥自用方便可选择无有效期）

        <Aside type="caution">🚧施工中。。。</Aside>
    </TabItem>
</Tabs>

### 2. Git设置


<Steps>

1. gpg程序位置（非使用Git Bash自带gpg程序时必须）

    因git bash自带gpg加密程序，git提交时默认使用自己的gpg加密，我们需要修改成kleopatra附带的程序。

    ```shell
    # 当使用gpg4win时需此配置，使用git内置的gpg生成时不需要
    git config --global gpg.program <YOUR_GPG_PROGRAM>

    # 例：git config --global gpg.program "C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe"
    ```

    > gpg程序路径在默认安装时，可以在文件管理中看kleopatra的同级目录

2. 自动使用gpg加签

    ```shell
    git config --global commit.gpgsign true
    git config --global tag.gpgsign true
    ```

    > PS这一步可选，但提交前commit命令添加参数（-s）
    > ```shell
    > git commit -s -m "_commit_message_"
    > ```

3. 添加你的Gpg Key ID

    ```bash
    git config --global user.signingkey <YOUR_GPG_KEY_ID>
    ```


    <Aside type="caution">

        **kleopatra 获取GPG_KEY_ID**

        ![](/blogs/git-commit-gpg/get-gpg-key-id-01.png)

        **命令行 获取GPG_KEY_ID**

        输入命令打印

        ```shell
        gpg --list-secret-keys --keyid-format=long
        ```

        ![](/blogs/git-commit-gpg/get-gpg-key-id-02.png)
    </Aside>

</Steps>

### 3. GPG公钥设置

<Tabs syncKey="git-platform">
    <TabItem label="Github">
        ![](/blogs/git-commit-gpg/set-github-gpg-pub-key-01.png)

        ![](/blogs/git-commit-gpg/set-github-gpg-pub-key-02.png)
    </TabItem>
    <TabItem label="GitCode">
        ![](/blogs/git-commit-gpg/set-gitcode-gpg-pub-key-01.png)

        > 复制出来的公钥末尾可能带有回车，需要删掉不然校验提示保存不了，密钥本身无错

        ![](/blogs/git-commit-gpg/set-gitcode-gpg-pub-key-02.png)

    </TabItem>
</Tabs>

## 效果

### Git提交记录会显示加签标记
![](/blogs/git-commit-gpg/look-01.png)

### Github提交记录显示
![](/blogs/git-commit-gpg/look-02.png)

## 扩展

查看绿标显示签名用户和邮箱

### 导入他人gpg公钥到kleopatra

1. 需要他人提供gpg公钥并导入

![](/blogs/git-commit-gpg/extension-import-gpg-pub-key-01.png)

2. 认证

![](/blogs/git-commit-gpg/extension-import-gpg-pub-key-02.png)

3. 选择自己的认证方式

![](/blogs/git-commit-gpg/extension-import-gpg-pub-key-03.png)


### Git提交记录验证其他提交者
1. 需要项目成员提供他的gpg公钥并导入(导入方式见:[导入他人gpg公钥到kleopatra](#导入他人gpg公钥到kleopatra))

![](/blogs/git-commit-gpg/extension-01.png)

拥有他人公钥后验证将变为绿标。

![](/blogs/git-commit-gpg/extension-02.png)
